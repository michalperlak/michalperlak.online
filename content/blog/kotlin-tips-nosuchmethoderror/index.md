---
title: NoSuchMethodError using Kotlin extension functions. Be careful about your naming
date: "2020-06-06T18:12:03.284Z"
description: "Kotlin extension functions are awesome, there is no doubt about that. However, in some rare scenarios using them may cause hard to debug NoSuchMethodError thrown at runtime. Let's analyze one of such scenarios."
---

### Example project

To illustrate the problem, I've prepared the very simple project. 
The full source code is available in my github:  https://github.com/michalperlak/kotlin-extension-functions-example.

The project has two modules:
 - utils
 - app
 
The app module depends on the utils module. 

Inside the utils module we have one file named `ListExt` which contains one extension function for a list of strings:
```kotlin
package dev.talkischeap.utils

fun List<String>.lowerCased(): List<String> = map(String::toLowerCase)
```

In the app module, we have similar file, also named `ListExt`, with one extension function:
```kotlin
package dev.talkischeap.utils

fun List<String>.startingWithLetter(): List<String> =
    filter {
        it.isNotEmpty() && it.first().isLetter()
    }
```

Also, we have the `ExampleApp` file which contains the `main` method for the application:
```kotlin
package dev.talkischeap

import dev.talkischeap.utils.lowerCased
import dev.talkischeap.utils.startingWithLetter

fun main() {
    val values = listOf("ABCdef", "12345", "12def")
    val result = values
        .startingWithLetter()
        .lowerCased()
    println(result)
}
```

Everything looks ok for now, so let's try to build the application. The project builds successfully without any
warnings both in Intellij IDEA and Gradle. 

The only missing step is to run the application. And...
```text
Exception in thread "main" java.lang.NoSuchMethodError: 'java.util.List dev.talkischeap.utils.ListExtKt.lowerCased(java.util.List)'
	at dev.talkischeap.ExampleAppKt.main(ExampleApp.kt:10)
	at dev.talkischeap.ExampleAppKt.main(ExampleApp.kt)
```

### What has happened here?

To find the source of the problem, we need to check the `.class` files generated by the compiler.

For the `utils` module we have the class named `ListExtKt.class` with the following content (decompiled by IJ):
```kotlin
// IntelliJ API Decompiler stub source generated from a class file
// Implementation of methods is not available

package dev.talkischeap.utils

public fun kotlin.collections.List<kotlin.String>.lowerCased(): kotlin.collections.List<kotlin.String> { /* compiled code */ }
```

And for the `app` module we have the file with the same name with content:
```kotlin
// IntelliJ API Decompiler stub source generated from a class file
// Implementation of methods is not available

package dev.talkischeap.utils

public fun kotlin.collections.List<kotlin.String>.startingWithLetter(): kotlin.collections.List<kotlin.String> { /* compiled code */ }
```

We can clearly see that we have two classes with the same qualified name: `dev.talkischeap.utils.ListExtKt`. 
The classloader can load only one class for a qualified name, and it just loads the first class found on classpath
for the requested name. As a result, in runtime only the functions from the `app` module are available.


Fortunately, the fix is simple. It is enough to change the file name or the package name.

And, the problem is reported to the Kotlin issue tracker, so it may be fixed in the later versions of the compiler.
The details can be found on issue page: https://youtrack.jetbrains.com/issue/KT-24485